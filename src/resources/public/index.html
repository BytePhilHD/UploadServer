<!DOCTYPE html>
<html lang="en" style="background-color:lightslategray;">
<body style="background-color:lightslategray;"></body>
<head>
    <meta charset="UTF-8">
    <title>TestServer</title>
</head>
<body>

<p>---</p>
<p>Hallöle</p>
<p>Das is eine TestSeite! </p>
<p>Für weitere Infos gebe das Passwort ein!</p>
<p>.</p>

<label for="pw">Passwort:</label>
<input type="text"
       id="pw" name="pw"><br><br>

<button onclick="manageInput()" class="btn btn-primary" type="button" style="margin: 4px;">Senden</button>


<p id="input"></p>
<p>.</p>

<script>
    window.onload = setupWebSocket;
    let ws;
    const test = true;

    function manageInput() {
        let input = document.getElementById("pw").value;
        document.getElementById('pw').value = '';
        ws.send("PASSWORD: " + input);
    }

    function setupWebSocket() {
        let i = 80;
        if (location.port != 0) {
            i = location.port;
        }
        if (location.search != 0) {
            window.location.href = location.protocol + "//" + location.host;
        }
        ws = new WebSocket("ws://" + location.hostname + ":" + i + "/websockets");

        ws.onclose = closeEvent => {
            setupWebSocket();
        }
        ws.onerror = errorEvent => {
            document.getElementById("input").innerHTML = "Server is not responding! Please try again!";
        }
        ws.onmessage = messageEvent => {
            var wsinput = messageEvent.data;
            if (wsinput.includes("CORRECT")) {
                wsinput = wsinput.replace("CORRECT ", "");
                document.getElementById("input").innerHTML = "Correct password!";
                window.location.href = location + "home?" + wsinput;

            } else if (wsinput.includes("WRONG")) {
                document.getElementById("input").innerHTML = "Wrong password! Please try again!";
            }
        }
    }
</script>
</body>
</html>